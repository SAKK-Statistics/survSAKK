---
title: "Creating survival plot"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Creating survival plot}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  echo = TRUE,
  eval = FALSE,
  fig.height = 6,
  fig.width = 7,
  fig.align='center'
)
```

After inserting the `survfit{survival}` object into `surv.plot{survSAKK}`, we can create simple survival curves, allowing to visualize survival patterns and incorporate various statistics in our plot.

To show some benefit of this function,  *Veterans' Administration Lung Cancer study* data, available in the survival package is used.

# Data

```{r setup, warning=FALSE}
# Load required libraries
library(survSAKK)
library(survival)

# Load data
# lung data
veteran <- survival::veteran

# Define the reference arm
veteran$trt <- factor(veteran$trt,
                      levels = c(1,2),
                      labels = c("Standard","Test"))

# Create survival objects
veteran_fit_yr <- survfit(Surv(time / 365.25, status) ~ 1, data = veteran)
veteran_fit_mt <- survfit(Surv(time / 365.25 * 12, status) ~ 1, data = veteran)
veteran_trt_fit_yr <- survfit(Surv(time / 365.25, status) ~ trt, data = veteran)
veteran_trt_fit_mt <- survfit(Surv(time / 365.25 * 12, status) ~ trt, data = veteran)

```

# Drawing basic survival plot

##
```{r baseplot}
surv.plot(veteran_fit_yr)
```

## Customize colour, legend names, title, axis

## Customisation of ticks and axis limits

## Adjustment of font size:

### Global adjustment of the size

### Specified adjustment of the size


## Custamisation of the x and y axis label position

## Custamisation of the marging area

## Custamization of Time.unit und y.unit

# Drawing risk table

Per default the risk table is provided below the Kaplan-Meier plot. It provides information about the number of patients at risk at different time points thought the study.

## Undisplay risk table

```{r risktable1}
surv.plot(veteran_trt_fit_yr,
          risktable = FALSE)
```

## Modify risktable position

```{r risktable.pos}
surv.plot(veteran_fit_yr,  
          # How many bottom lines should be drawn
          margin.bottom = 10,
          # How many left lines should be drawn
          margin.left = 4,
          # Define position of the risk table
          risktable.pos = 8.5)
```

## Modify risk table title, label names, colour


# Drawing segment

In this section is shown how to highlight a specific quantile or time point as a segment in the survival curve and how to adjust segment options.

## Drawing segment line for a specific quantile

Drawing a segment line for the median, which corresponds to 0.5 quantile.

```{r median}
surv.plot(veteran_fit_yr,
          # Segment Options
          segment.quantile = 0.5)
```

## Drawing segment line for a specific time point

Drawing a segment line at time point 1.

```{r timepoint}
surv.plot(veteran_fit_yr,
          # Segment Options
          segment.timepoint = 1)
```

## Customization of segment title, font size, and colour

## Add several segment lines, change line type

## Modify segment font

```{r segmentOption4}
surv.plot(veteran_fit_yr,
          # Segment Options
          segment.quantile = 0.5,
          segment.type = 1,
          segment.cex = 0.75,
          segment.font = 3,
          segment.main.font = 2) 
```

## Modify segment line type, line width and text spacing

```{r segmentOption5}
surv.plot(veteran_fit_yr,
          # Segment Options
          segment.quantile = 0.5,
          segment.annotation = c(3, 0.06),
          segment.col = "darkgreen",
          ## segment type 
          segment.type = 1,
          ## segment line type
          segment.lty = 'dotted',
          ## segment line width
          segment.lwd = 1.5,
          # spacing between the text in unit of x-coordinates
          segment.annotation.space = 0.16) 
```

# Inlcude statistics

There is three options to display the statistics:

- `logrank`

gives the p value of the conducted log rank test using `survdiff{survival}`.

- `coxph`

gives the hazard ratio (HR) and its 95% CI of the conducted Cox proportional hazards regression using `coxph{survival}`.⁠

- . . .

## `logrank test`

```{r stat1}

surv.plot(veteran_trt_fit_yr,
          stat = "logrank")
```

## `coxph`

```{r stat2}
surv.plot(veteran_trt_fit_yr,
          show.legend = FALSE,
          stat = "coxph",
          stat.position = "bottomright")
```

## `..`


## short version ... 

## Modify stat position, colour, text size, and text font

```{r stat4}
surv.plot(veteran_trt_fit_yr,
          # Segment Options
          stat = "logrank",
          stat.position = "bottomright",
          stat.col = "darkblue",
          stat.cex = 0.85,
          stat.font = 2)
```

# Multiple survival plots

```{r plots1, fig.height = 8, fig.width = 8}

par(mfrow=c(2,2))
# Plot 1
surv.plot(fit = veteran_fit_yr,
          cex = 0.8,
          risktable.name.position = -0.7)
# Plot 2
surv.plot(fit = veteran_fit_yr, 
          x.ticks = seq(0,3,0.5),
          cex = 0.8,
          segment.quantile = 0.5,
          segment.annotation = "none",
          risktable.name.position = -0.5)
# Plot 3
surv.plot(fit = veteran_fit_yr, 
          col = "darkred",
          x.ticks = seq(0,3,0.5),
          cex = 0.8,
          legend.name = "Veterans",
          show.legend = FALSE,
          segment.quantile = 0.5,
          segment.annotation = "right",
          segment.cex = 0.7,
          risktable.name.position = -0.7)
par(mfrow=c(1,1))
```

```{r plots2, fig.height = 12, fig.width = 8}
par(mfrow=c(2,1))
# Plot 1
surv.plot(fit = veteran_trt_fit_yr,
          bty = 'o',
          cex = 0.75,
          legend.title = "Treament regimens",
          legend.name = c("LT60","OV60"),
          legend.text.font = 2,
          col = c("darkred", "darkblue"),
          x.ticks = seq(0,3, by = 0.5),
          xlab = ("Time (month)"),
          segment.quantile = 0.5,
          stat = "logrank", 
          stat.position = "bottomleft",
          risktable.col = c("darkred","darkblue"))

# Plot 2
surv.plot(fit = veteran_trt_fit_yr,
          grid =TRUE,
          cex = 0.75,
          col = c("darkgreen","yellow4"),
          xlab = "Time (year)",
          x.ticks = seq(0,3, by = 1),
          legend.position = "bottomleft",
          stat = "coxmodel",
          stat.position = "bottomright")
par(mfrow=c(1,1))

```


